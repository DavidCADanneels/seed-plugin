/**
 * Docker build
 */

// Getting the DSL Core library

configurations {
    dslCore
}

dependencies {
    dslCore(group: 'org.jenkins-ci.plugins', name: 'job-dsl-core', version: '1.32')
}

clean << {
    delete 'src/main/docker/job-dsl-core.jar'
}

task prepareDslLib(type: Copy) {
    from configurations.dslCore
    into 'src/main/docker'
    rename { String fileName -> "job-dsl-core.jar" }
}

// Getting the Seed plug-in

task prepareSeedHpi(type: Copy, dependsOn: jpi) {
    from jpi.archivePath
    into 'src/main/docker'
}

// Image build

task buildImage(dependsOn: [prepareDslLib, prepareSeedHpi])

// Link with the build

build.dependsOn buildImage
